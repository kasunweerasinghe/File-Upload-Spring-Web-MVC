<!--
* created by kasun weerasinghe
* Date: 2023-02-07
* Time: 09:14
* Project Name: FileUploadBackEnd
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Upload</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>

<section class="container mt-4">

    <div class="col-6">
        <form>
            <input id="file" name="myFile" type="file" class="form-control">
            <button type="button" id="btnUpload" class="btn btn-primary mt-2">Upload File</button>
        </form>
    </div>


    <div class="col-8 mt-4">
        <div id="display" class="border" style="height: 250px"></div>
        <button type="button" id="btnLoad" class="btn btn-outline-success mt-2">Load</button>

    </div>
</section>

<script src="css/bootstrap.min.css"></script>
<script src="js/jquery-3.6.1.min.js"></script>

<script>

    let baseUrl = "http://localhost:8080/FileUploadBackEnd_war/";

    loadImage();

    $("#btnUpload").click(function () {
        var data = new FormData();
        let file = $("#file")[0].files[0];
        let fileName = $("#file")[0].files[0].name;
        data.append("myFile", file, fileName);

        $.ajax({
            url: baseUrl + "api/v1/upload",
            method: 'post',
            async: true,
            contentType: false,
            processData: false,
            data: data,
            success: function (resp) {
                alert("Successfully Uploaded");
                loadImage();
            },
            error: function (err) {
                console.log(err);
            }
        });
    });

    $("#btnLoad").click(function () {
        loadImage();
    });


    function loadImage() {
        $.ajax({
            url: baseUrl + "api/v1/upload",
            method: 'get',
            dataType: 'json',
            success: function (resp) {
                let url = resp[resp.length - 1];

                $("#display").css({
                    "background": `url(${baseUrl + url})`,
                    "background-size": "cover",
                    "height": "300px"
                });

            },
            error: function (err) {
                console.log(err);
            }
        });
    }

</script>
</body>
</html>